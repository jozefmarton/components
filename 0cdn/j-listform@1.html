<style>.ui-listform-invalid .ui-listform-items{border-color:red}.ui-listform-container{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-listform-items .ui-listform-item:first-child{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.ui-listform-items .ui-listform-item:last-child{border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}.ui-listform-form-container{background-color:#F8F8F8;padding:15px}.ui-listform-form{border-radius:var(--radius);border:1px solid #E0E0E0;background-color:#FFF}.ui-listform-emptylabel{text-align:center;display:none;padding:15px;font-size:12px;color:gray}.ui-listform-empty .ui-listform-emptylabel{display:block}.ui-listform-item{border-bottom:1px solid #E0E0E0;cursor:pointer}.ui-listform-selected{font-weight:bold;background-color:#F8F8F8}.ui-listform-item:last-child{border-bottom:0}.ui-disabled .ui-listform-item{cursor:not-allowed;color:gray}.ui-listform-new button[name='remove']{display:none}.ui-listform-item-highlight{background-color:rgba(0,0,0,0.1)}.ui-dark .ui-listform-container{border-color:#404040}.ui-dark .ui-listform-form-container{background-color:#282828}.ui-dark .ui-listform-form{border-color:#404040;background-color:#232323}.ui-dark .ui-listform-item{border-bottom-color:#404040}.ui-dark .ui-listform-selected{background-color:#282828}.ui-dark .ui-disabled .ui-listform-item{color:#777}.ui-dark .ui-listform-emptylabel{color:#777}.ui-dark .ui-listform-item-highlight{background-color:rgba(255,255,255,0.1)}</style>
<script>COMPONENT('listform@1','empty:---;default:1;delay:1000',function(self,config,cls){var cls2='.'+cls,rendered=false,skip2=false,skip=false,container,form,items,plugin;self.validate=function(value){if(config.disabled)return true;var valid=config.required?!!(value&&value.length>0):true;if(valid&&config.invalidform)valid=self.$$invalid?false:valid;return valid};self.make=function(){plugin=config.plugin||self.ID;self.aclass(cls+' invisible');if(config.selector){var customselector=$(document).find(config.selector);self.html(customselector.html())}var scr=self.find('script');var tmp;self.template=Tangular.compile(scr.eq(0).html());form='<div class="{0}-form-container hidden{2}"><ui-plugin path="{1}" config="isolated:1"><div class="{0}-form">{3}</div></ui-plugin></div>'.format(cls,plugin,config.formclass?(' '+config.formclass):'',scr.eq(1).html());tmp=scr.eq(2).html();scr.remove();var footer=tmp?'<div class="{0}-footer">{1}</div>'.format(cls,tmp):'';if(footer&&config.footertop)self.append(tmp);self.append('<div class="{0}-container"><div class="{0}-emptylabel">{1}</div><div class="{0}-items"></div></div>'.format(cls,config.empty));if(footer&&!config.footertop)self.append(tmp);container=self.find(cls2+'-items');var entersubmit=function(){self.find('button[name="submit"]').trigger('click')};config.enter&&self.event('keydown','input',function(e){if(config.enter&&e.which===13)setTimeout2(self.ID,entersubmit,200)});self.event('click',cls2+'-item',function(){if(config.disabled)return;var t=this;if(form.$target===t)self.cancel();else self.edit(t)});self.event('click','button',function(e){if(config.disabled)return;var el=$(this);var parent=el.closest(cls2+'-item');var tmp,fn;if(parent.length){var data=parent[0].$data;self.cancel();e.stopPropagation();switch(this.name){case'up':case'down':tmp=parent.aclass(cls+'-item-highlight');tmp.rclass(cls+'-item-highlight',1000);var index=items.indexOf(data);tmp=index+(this.name==='up'?-1:1);if(tmp<0||tmp>=items.length)return;var a=items[tmp];items[tmp]=items[index];items[index]=a;NODEMOVE(parent[0],this.name==='up');skip=true;self.bind('@modified @touched @setter',items);config.move&&self.EXEC(config.move,items);break;case'remove':fn=function(is){self.cancel();if(is!==false&&data){parent.remove();items.splice(items.indexOf(data),1);skip=true;self.bind('@modified @touched @setter',items)}};if(config.remove)self.EXEC(config.remove,data,fn,self.get());else fn();break}return}var is=false;switch(this.name){case'create':self.add();is=true;break;case'submit':case'update':tmp=GET('{0} @reset'.format(plugin));fn=function(tmp){if(tmp){if(!items)items=[];if(form.$target){COPY(tmp,form.$data);self.redraw(form.$target,form.$data)}else{items.push(tmp);self.create(tmp)}self.$$invalid=false;skip=true;self.bind('@modified @touched @setter',items)}self.cancel()};if(config[this.name])self.EXEC(config[this.name],tmp,fn,self.get(),form.$data);else fn(tmp);is=true;break;case'cancel':self.cancel();is=true;break;case'remove':var el=form.$target,data=form.$data;fn=function(is){if(is!==false&&data){el.parentNode.removeChild(el);items.splice(items.indexOf(data),1);skip=true;self.$$invalid=false;self.bind('@modified @touched @setter',items)}self.cancel()};if(config.remove)self.EXEC(config.remove,data,fn,self.get());else fn();is=true;break}if(is){e.preventDefault();e.stopPropagation()}})};self.configure=function(key,value,init){switch(key){case'disabled':self.tclass('ui-'+key,!!value);self.find('button[name="create"]').prop('disabled',!!value);break;case'required':self.tclass(cls+'-'+key,!!value);if(!init)self.validate2();break}};self.add=function(){self.check();if(!$(form).hclass('hidden')&&!form.$data){self.cancel();return}var fn=function(obj){if(config.newbie)obj[config.newbie]=true;if(config.create||!config.default)SET('{0} @reset'.format(plugin),obj);else SET('{0} @default'.format(plugin),obj);self.edit()};if(config.create)self.EXEC(config.create,{},fn,self.get());else fn({})};self.check=function(){if(!self.$$check){form=$(form)[0];container.append(form);self.compile&&self.compile();self.$$check=true;self.$$invalid=true;if(config.invalidform)self.validate2()}};self.edit=function(el){self.check();self.cancel();var before,parent;if(el){parent=el.parentNode;var children=parent.children;for(var i=0;i<children.length;i++){if(children[i]===el){before=children[i+1];break}}form.$target=el;form.$data=el.$data;SET('{0} @reset'.format(plugin),CLONE(el.$data));$(el).aclass(cls+'-selected')}else{parent=container[0];form.$target=form.$data=null}if(before)parent.insertBefore(form,before);else parent.appendChild(form);if(!rendered&&config.delay>300)SETTER('loading/show');setTimeout(function(){if(!rendered&&config.delay>300)SETTER('loading/hide');rendered=true;$(form).tclass(cls+'-new',!el).rclass('hidden');config.autofocus&&self.autofocus(config.autofocus)},rendered?100:config.delay);if(config.invalidform){self.$$invalid=true;self.validate2();skip2=true;self.update()}};self.cancel=function(){if(self.$$check){if(self.$$invalid){self.$$invalid=false;self.validate2();skip2=true;self.update()}if(form.parentNode!==self.dom)self.dom.appendChild(form);form.$target&&$(form.$target).rclass(cls+'-selected');form.$target=form.$data=null;$(form).aclass('hidden')}};self.redraw=function(el,data){el.innerHTML=self.template(data)};self.create=function(item){var dom=document.createElement('DIV');dom.setAttribute('class',cls+'-item'+(config.itemclass?(' '+config.itemclass):''));dom.innerHTML=self.template(item);dom.$data=item;container[0].appendChild(dom)};self.setter=function(value,path,type){if(skip2){skip2=false;return}if((M.is20&&type.init)||!type)self.rclass('invisible');items=value;self.tclass(cls+'-empty',!value||!value.length);self.cancel();if(skip){skip=false;return}form.$data&&self.cancel();container.find(cls2+'-item').remove();if(value){for(var i=0;i<value.length;i++)self.create(value[i])}};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)}});</script>